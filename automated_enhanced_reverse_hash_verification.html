<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayU Hash Verification Tool</title>
    <!-- Add SHA-512 library (from crypto-js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* PayU Green/Teal Theme */
            --bg-color: #F7FAF9;
            --card-bg: #ffffff;
            --text-color: #1a202c;
            --text-muted: #718096;
            --input-bg: #f8fafc;
            --input-border: #e2e8f0;
            --input-text: #1a202c;
            
            /* PayU Primary Colors */
            --primary-color: #10846D;
            --primary-dark: #024538;
            --primary-light: #48bb78;
            --secondary-color: #10b981;
            --secondary-dark: #059669;
            --error-color: #f56565;
            --warning-color: #ed8936;
            --success-color: #48bb78;
            
            /* UI elements */
            --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --card-shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            background: var(--bg-color);
            color: var(--text-color);
            padding: 0;
            min-height: 100vh;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* PayU Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header-logo svg {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .header-text-wrapper h1 {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .beta-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            letter-spacing: 1px;
        }
        
        .header-text-wrapper p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            font-weight: 400;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            padding: 0 20px 20px 20px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            padding: 32px;
            margin-bottom: 24px;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }
        
        .card:hover {
            box-shadow: var(--card-shadow-hover);
            transform: translateY(-2px);
        }
        
        .card-header {
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .card-title {
            color: var(--text-color);
            font-weight: 600;
            font-size: 1.5rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-title i {
            color: var(--primary-color);
            font-size: 1.4rem;
        }
        
        .card-subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
            font-weight: 400;
        }
        
        .notice {
            background: linear-gradient(135deg, rgba(16, 132, 109, 0.1) 0%, rgba(72, 187, 120, 0.05) 100%);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 28px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }
        
        .notice::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 0%, rgba(255,255,255,0.05) 50%, transparent 100%);
            pointer-events: none;
        }
        
        .notice strong {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .notice strong i {
            font-size: 1.1rem;
        }
        
        .notice code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: rgba(16, 132, 109, 0.1);
            padding: 12px 16px;
            border-radius: 8px;
            display: block;
            margin-top: 8px;
            word-break: break-all;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.5;
            font-size: 0.85rem;
            border: 1px solid rgba(16, 132, 109, 0.2);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            color: var(--text-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .input-group {
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .input-group.full-width {
            grid-column: 1 / -1;
        }
        
        .input-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .input-group label i {
            color: var(--primary-color);
            font-size: 1rem;
        }
        
        .input-group input, 
        .input-group select, 
        .input-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--input-border);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: var(--transition);
            background: var(--input-bg);
            color: var(--input-text);
            font-family: inherit;
            font-weight: 400;
        }
        
        .input-group textarea {
            resize: vertical;
            min-height: 140px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        .input-group input:focus, 
        .input-group select:focus, 
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--card-bg);
            box-shadow: 0 0 0 3px rgba(16, 132, 109, 0.3);
            transform: translateY(-1px);
        }
        
        .input-group input:required:not(:placeholder-shown):valid,
        .input-group select:required:valid {
            border-color: var(--success-color);
            background: rgba(72, 187, 120, 0.05);
        }
        
        .input-group input:required:not(:placeholder-shown):invalid {
            border-color: var(--error-color);
            background: rgba(245, 101, 101, 0.05);
        }
        
        .salt-field {
            border-left: 4px solid var(--warning-color) !important;
            background: rgba(237, 137, 54, 0.1) !important;
        }
        
        .salt-field:focus {
            border-color: var(--warning-color) !important;
            box-shadow: 0 0 0 3px rgba(237, 137, 54, 0.2) !important;
        }
        
        .conditional-field {
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: var(--transition);
        }
        
        .conditional-field.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            min-width: 160px;
            box-shadow: 0 4px 12px rgba(16, 132, 109, 0.3);
            text-align: center;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 132, 109, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button i {
            font-size: 1rem;
        }
        
        .parse-button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            box-shadow: 0 4px 12px rgba(16, 132, 109, 0.3);
        }
        
        .parse-button:hover {
            box-shadow: 0 8px 20px rgba(16, 132, 109, 0.4);
        }
        
        .clear-button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            box-shadow: 0 4px 12px rgba(16, 132, 109, 0.3);
        }
        
        .clear-button:hover {
            box-shadow: 0 8px 20px rgba(16, 132, 109, 0.4);
        }
        
        .verification-result, .parse-result {
            font-weight: 500;
            padding: 24px;
            border-radius: var(--border-radius);
            margin-top: 28px;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        @keyframes slideInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .verification-success, .parse-success {
            background: linear-gradient(135deg, rgba(72, 187, 120, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
        }
        
        .verification-error, .parse-error {
            background: linear-gradient(135deg, rgba(245, 101, 101, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
            border-left: 4px solid var(--error-color);
            color: var(--error-color);
        }
        
        .verification-details {
            margin-top: 20px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.85rem;
            background: rgba(0,0,0,0.05);
            padding: 20px;
            border-radius: var(--border-radius);
            word-break: break-all;
            line-height: 1.6;
            border: 1px solid rgba(0,0,0,0.1);
            color: var(--text-color);
        }
        
        .verification-details strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .debug-info {
            margin-top: 20px;
            font-size: 0.9rem;
            background: rgba(16, 132, 109, 0.05);
            padding: 20px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--text-muted);
            color: var(--text-color);
        }
        
        .debug-info strong {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .callback-help {
            background: linear-gradient(135deg, rgba(237, 137, 54, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%);
            border-left: 4px solid var(--warning-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 24px;
            font-size: 0.9rem;
            position: relative;
            color: var(--text-color);
        }
        
        .formula-note {
            background: linear-gradient(135deg, rgba(72, 187, 120, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border-left: 4px solid var(--success-color);
            padding: 16px;
            border-radius: var(--border-radius);
            margin-top: 16px;
            font-size: 0.9rem;
            color: var(--success-color);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-success {
            background: rgba(72, 187, 120, 0.2);
            color: var(--success-color);
        }
        
        .status-warning {
            background: rgba(237, 137, 54, 0.2);
            color: var(--warning-color);
        }
        
        .feature-highlight {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(16, 132, 109, 0.15);
            color: var(--primary-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin: 2px;
        }
        
        /* Enhanced Responsive Design */
        @media screen and (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .header-text-wrapper h1 {
                font-size: 1.5rem;
                justify-content: center;
            }
            
            .card {
                padding: 24px;
                margin-bottom: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media screen and (max-width: 480px) {
            body {
                padding: 0;
            }
            
            .card {
                padding: 20px;
            }
            
            .notice code {
                font-size: 0.8rem;
                padding: 10px 12px;
            }
        }
        
        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus management for better accessibility */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        /* New formula badge */
        .new-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f43f5e 0%, #ec4899 100%);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(244, 63, 94, 0.3);
        }
    </style>
</head>
<body>
    <!-- PayU Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-logo">
                <svg width="134" height="134" viewBox="0 0 134 134" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.898 42.6916C21.1529 41.7286 21.1188 39.2323 22.837 38.2219L65.1248 13.355C65.8802 12.9108 66.8097 12.8817 67.5913 13.2777L112.023 35.7869C113.848 36.7111 113.916 39.2916 112.144 40.3114L67.5935 65.9407C66.8135 66.3894 65.8557 66.3979 65.0678 65.9631L22.898 42.6916Z" fill="white"></path>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M18.0879 45.9843C18.0879 44.6797 19.4872 43.8529 20.6302 44.4821L63.933 68.3182C64.4805 68.6197 64.8206 69.1954 64.8206 69.8205V118.783C64.8203 120.149 63.3003 120.966 62.1603 120.213L18.8574 91.6101C18.3769 91.2926 18.0879 90.7549 18.0879 90.179V45.9843ZM45.817 72.47C45.1586 72.1055 44.7141 72.3645 44.7058 73.1173C44.6976 73.87 45.131 74.6147 45.7894 74.9796C46.997 75.6484 47.9726 77.3256 47.9574 78.706L47.9164 82.47C47.8998 83.9758 48.4349 85.5354 49.4119 87.0865C48.4129 87.5432 47.85 88.494 47.8335 89.9998L47.7924 93.7638C47.7772 95.1441 46.7767 95.7263 45.5692 95.0576C44.9105 94.6928 44.4654 94.952 44.4571 95.7049C44.449 96.4577 44.8829 97.2024 45.5415 97.5672C47.9567 98.9048 49.9577 97.7404 49.988 94.9797L50.0291 91.2157C50.0443 89.8353 51.0448 89.2531 52.2523 89.9219C52.9109 90.2866 53.3559 90.028 53.3644 89.2754C53.3727 88.5225 52.9386 87.7771 52.28 87.4123C51.0725 86.7435 50.097 85.067 50.112 83.6867L50.153 79.9219C50.1834 77.1612 48.2322 73.8076 45.817 72.47ZM37.0345 67.6064C34.6196 66.269 32.6194 67.4328 32.5889 70.1931L32.547 73.958C32.5318 75.3383 31.5313 75.9206 30.3238 75.2518C29.6652 74.8871 29.221 75.1456 29.2125 75.8982C29.2043 76.6511 29.6375 77.3965 30.2961 77.7614C31.5036 78.4302 32.4791 80.1066 32.4641 81.4869L32.4231 85.2518C32.3927 88.0125 34.3439 91.366 36.759 92.7037C37.4176 93.0683 37.862 92.8092 37.8703 92.0564C37.8785 91.3035 37.4453 90.558 36.7867 90.1932C35.5791 89.5244 34.6035 87.848 34.6187 86.4677L34.6597 82.7036C34.6763 81.1978 34.1411 79.6382 33.1642 78.0871C34.1632 77.6305 34.7261 76.6797 34.7426 75.1739L34.7845 71.4098C34.7997 70.0295 35.8002 69.4473 37.0078 70.1161C37.6662 70.4806 38.1107 70.2215 38.119 69.4688C38.1271 68.7159 37.6932 67.9712 37.0345 67.6064Z" fill="white"></path>
                    <path d="M92.255 78.8316C93.0255 78.3513 93.5555 78.6363 93.5798 79.5442C93.604 80.4522 93.1062 81.378 92.3354 81.8587L89.7663 83.4606C88.9956 83.9413 88.4659 83.6568 88.4416 82.7489C88.4173 81.841 88.9145 80.9151 89.6851 80.4343L92.255 78.8316Z" fill="white"></path>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M112.83 42.8793C113.974 42.2099 115.412 43.0342 115.412 44.359V89.741C115.412 90.3219 115.118 90.8634 114.631 91.1796L70.4705 119.824C69.3295 120.564 67.8218 119.745 67.8218 118.385V70.2191C67.8218 69.6101 68.1446 69.0463 68.6701 68.7386L112.83 42.8793ZM95.7846 64.3214C95.7603 63.4134 95.2306 63.1289 94.4599 63.6096C93.6893 64.0903 93.1912 65.0162 93.2155 65.9241L93.3369 70.4636L88.1987 73.6683L88.0773 69.128C88.0529 68.2202 87.5232 67.9356 86.7526 68.4162C85.9818 68.8969 85.484 69.8227 85.5082 70.7307L85.6296 75.271L81.776 77.6743C81.0052 78.155 80.5074 79.0808 80.5316 79.9888C80.556 80.8967 81.0857 81.1812 81.8564 80.7006L83.1409 79.9001L83.3436 87.4667C83.3557 87.9207 83.4922 88.1432 83.7572 88.2856L87.3345 90.2091L87.5204 97.1703C87.5447 98.0782 88.0746 98.3633 88.8452 97.8829C89.6159 97.4023 90.1137 96.4763 90.0895 95.5684L89.9279 89.5149L92.497 87.9122L92.6586 93.9656C92.6829 94.8737 93.2135 95.1589 93.9842 94.6782C94.7548 94.1976 95.2519 93.2716 95.2277 92.3637L95.0418 85.4017L98.4014 79.1531C98.6503 78.6902 98.7703 78.3067 98.7581 77.8527L98.5563 70.2861L99.8409 69.4847C100.612 69.004 101.109 68.0781 101.085 67.1702C101.061 66.2623 100.53 65.9777 99.7597 66.4584L95.906 68.8617L95.7846 64.3214Z" fill="white"></path>
                </svg>
            </div>
            <div class="header-text-wrapper">
                <h1>PayU Integration Lab</h1>
                <p>Hash Verification & Debugging Tool</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Callback Data Parser Section -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-download"></i>
                    Callback Data Parser
                </h2>
                <p class="card-subtitle">Paste your PayU callback response data to auto-fill the form below</p>
            </div>
            
            <div class="callback-help">
                <strong><i class="fas fa-info-circle"></i> Supported Formats & Features:</strong><br>
                <div style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px;">
                    <span class="feature-highlight"><i class="fas fa-link"></i> URL Parameters</span>
                    <span class="feature-highlight"><i class="fas fa-unlock"></i> URL-Encoded Data</span>
                    <span class="feature-highlight"><i class="fas fa-code"></i> JSON Format</span>
                    <span class="feature-highlight"><i class="fab fa-php"></i> PHP Array</span>
                    <span class="feature-highlight"><i class="fas fa-list"></i> Key-Value Pairs</span>
                </div>
                <div style="margin-top: 16px;">
                    <strong>Auto URL Decoding:</strong> Automatically decodes + â†’ space, %40 â†’ @, %3A â†’ :, etc.<br>
                    <strong>Smart Field Mapping:</strong> additionalCharges â†’ additional_charges, splitInfo â†’ splitInfo<br>
                    <strong>Usage:</strong> Select hash formula â†’ Paste data â†’ Parse & Fill â†’ Enter SALT â†’ Verify
                </div>
            </div>
            
            <div class="form-row">
                <div class="input-group full-width">
                    <label for="callbackData">
                        <i class="fas fa-clipboard"></i>
                        Callback Response Data
                    </label>
                    <textarea id="callbackData" placeholder="Paste your callback data here...
Examples:
ðŸ“Ž URL format: status=success&amount=10.00&txnid=T12345&key=gtKFFx...
ðŸ”“ URL-encoded: status=success&email=test%40example.com&productinfo=Product+Info&amount=10.00
ðŸ“„ JSON format: {'status': 'success', 'amount': '10.00', 'txnid': 'T12345'}
ðŸ˜ PHP Array: [additionalCharges] => 10.00
           [splitInfo] => {'splitStatus':'splitNotReceived'}"></textarea>
                </div>
            </div>
            
            <div class="button-group">
                <button type="button" class="parse-button" onclick="parseAndFillForm()">
                    <i class="fas fa-magic"></i>
                    Parse & Fill Form
                </button>
                <button type="button" class="clear-button" onclick="clearAllFields()">
                    <i class="fas fa-eraser"></i>
                    Clear All Fields
                </button>
            </div>
            
            <div id="parseResult" class="parse-result"></div>
        </div>
        
        <!-- Hash Verification Section -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-shield-alt"></i>
                    Hash Verification System
                </h2>
                <p class="card-subtitle">Verify payment response hash values with multiple algorithm variations</p>
            </div>
            
            <!-- Hash Type Selection -->
            <div class="form-row">
                <div class="input-group">
                    <label for="hashType">
                        <i class="fas fa-list"></i>
                        Hash Verification Type
                    </label>
                    <select id="hashType" name="hashType" onchange="updateHashLogic()" required>
                        <option value="normal">Normal Reverse Hash Verification</option>
                        <option value="additional_charges">Additional Charges Reverse Hash Verification</option>
                        <option value="split">Split Reverse Hash Verification</option>
                        <option value="combined">Combined Split & Additional Charges Reverse Hash Verification <span class="new-badge"></span></option>
                    </select>
                </div>
            </div>
            
            <div id="hashLogicNotice" class="notice">
                <strong>
                    <i class="fas fa-cogs"></i>
                    Hash Verification Logic
                </strong>
                <code id="hashLogicCode">sha512(SALT|status||||||udf5|udf4|udf3|udf2|udf1|email|firstname|productinfo|amount|txnid|key)</code>
            </div>
            
            <form id="hashVerificationForm" class="verify-form">
                <!-- Conditional Fields for Additional Charges and Split Info -->
                <div class="form-row">
                    <div id="additionalChargesField" class="input-group conditional-field">
                        <label for="additional_charges">
                            <i class="fas fa-dollar-sign"></i>
                            Additional Charges
                        </label>
                        <input type="text" id="additional_charges" name="additional_charges" 
                               placeholder="Enter additional charges amount"
                               value="<%= request.getParameter("additional_charges") != null ? request.getParameter("additional_charges") : "" %>">
                    </div>
                    <div id="splitInfoField" class="input-group conditional-field">
                        <label for="splitInfo">
                            <i class="fas fa-code-branch"></i>
                            Split Info
                        </label>
                        <input type="text" id="splitInfo" name="splitInfo" 
                               placeholder="Enter split information JSON"
                               value="<%= request.getParameter("splitInfo") != null ? request.getParameter("splitInfo") : "" %>">
                    </div>
                </div>
                
                <!-- Core Hash Fields -->
                <div class="form-row">
                    <div class="input-group">
                        <label for="salt">
                            <i class="fas fa-key"></i>
                            SALT (Manual Entry Required)
                            <span class="status-indicator status-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                Required
                            </span>
                        </label>
                        <input type="text" id="salt" name="salt" 
                               class="salt-field"
                               placeholder="Enter your PayU SALT manually" 
                               required>
                    </div>
                    <div class="input-group">
                        <label for="status">
                            <i class="fas fa-info-circle"></i>
                            Transaction Status
                        </label>
                        <input type="text" id="status" name="status" 
                               placeholder="success, failure, pending"
                               value="<%= request.getParameter("status") != null ? request.getParameter("status") : "" %>" 
                               required>
                    </div>
                </div>
                
                <!-- UDF Fields -->
                <div class="form-row">
                    <div class="input-group">
                        <label for="udf5">
                            <i class="fas fa-tag"></i>
                            UDF5 (Optional)
                        </label>
                        <input type="text" id="udf5" name="udf5" 
                               placeholder="User Defined Field 5"
                               value="<%= request.getParameter("udf5") != null ? request.getParameter("udf5") : "" %>">
                    </div>
                    <div class="input-group">
                        <label for="udf4">
                            <i class="fas fa-tag"></i>
                            UDF4 (Optional)
                        </label>
                        <input type="text" id="udf4" name="udf4" 
                               placeholder="User Defined Field 4"
                               value="<%= request.getParameter("udf4") != null ? request.getParameter("udf4") : "" %>">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label for="udf3">
                            <i class="fas fa-tag"></i>
                            UDF3 (Optional)
                        </label>
                        <input type="text" id="udf3" name="udf3" 
                               placeholder="User Defined Field 3"
                               value="<%= request.getParameter("udf3") != null ? request.getParameter("udf3") : "" %>">
                    </div>
                    <div class="input-group">
                        <label for="udf2">
                            <i class="fas fa-tag"></i>
                            UDF2 (Optional)
                        </label>
                        <input type="text" id="udf2" name="udf2" 
                               placeholder="User Defined Field 2"
                               value="<%= request.getParameter("udf2") != null ? request.getParameter("udf2") : "" %>">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label for="udf1">
                            <i class="fas fa-tag"></i>
                            UDF1 (Optional)
                        </label>
                        <input type="text" id="udf1" name="udf1" 
                               placeholder="User Defined Field 1"
                               value="<%= request.getParameter("udf1") != null ? request.getParameter("udf1") : "" %>">
                    </div>
                    <div class="input-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i>
                            Email Address
                        </label>
                        <input type="email" id="email" name="email" 
                               placeholder="customer@example.com"
                               value="<%= request.getParameter("email") != null ? request.getParameter("email") : "" %>" 
                               required>
                    </div>
                </div>
                
                <!-- Customer & Transaction Details -->
                <div class="form-row">
                    <div class="input-group">
                        <label for="firstname">
                            <i class="fas fa-user"></i>
                            First Name
                        </label>
                        <input type="text" id="firstname" name="firstname" 
                               placeholder="Customer first name"
                               value="<%= request.getParameter("firstname") != null ? request.getParameter("firstname") : "" %>" 
                               required>
                    </div>
                    <div class="input-group">
                        <label for="productinfo">
                            <i class="fas fa-box"></i>
                            Product Info
                        </label>
                        <input type="text" id="productinfo" name="productinfo" 
                               placeholder="Product description"
                               value="<%= request.getParameter("productinfo") != null ? request.getParameter("productinfo") : "" %>" 
                               required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label for="amount">
                            <i class="fas fa-rupee-sign"></i>
                            Amount
                        </label>
                        <input type="text" id="amount" name="amount" 
                               placeholder="10.00"
                               value="<%= request.getParameter("amount") != null ? request.getParameter("amount") : "" %>" 
                               required>
                    </div>
                    <div class="input-group">
                        <label for="txnid">
                            <i class="fas fa-hashtag"></i>
                            Transaction ID
                        </label>
                        <input type="text" id="txnid" name="txnid" 
                               placeholder="Unique transaction identifier"
                               value="<%= request.getParameter("txnid") != null ? request.getParameter("txnid") : "" %>" 
                               required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label for="key">
                            <i class="fas fa-key"></i>
                            Merchant Key
                        </label>
                        <input type="text" id="key" name="key" 
                               placeholder="PayU merchant key"
                               value="<%= request.getParameter("key") != null ? request.getParameter("key") : "" %>" 
                               required>
                    </div>
                    <div class="input-group">
                        <label for="responseHash">
                            <i class="fas fa-fingerprint"></i>
                            Response Hash
                        </label>
                        <input type="text" id="responseHash" name="responseHash" 
                               placeholder="Hash received in PayU response"
                               value="<%= request.getParameter("hash") != null ? request.getParameter("hash") : "" %>" 
                               required>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="button" onclick="verifyHash()">
                        <i class="fas fa-check-circle"></i>
                        Verify Hash
                    </button>
                </div>
            </form>
            
            <div id="verificationResult" class="verification-result"></div>
        </div>
    </div>
    
    <!-- Enhanced JavaScript with all original functionality preserved -->
    <script>
        const fieldMapping = {
            'status': 'status',
            'firstname': 'firstname',
            'email': 'email',
            'productinfo': 'productinfo',
            'amount': 'amount',
            'txnid': 'txnid',
            'key': 'key',
            'hash': 'responseHash',
            'udf1': 'udf1',
            'udf2': 'udf2',
            'udf3': 'udf3',
            'udf4': 'udf4',
            'udf5': 'udf5',
            'additionalcharges': 'additional_charges',
            'additional_charges': 'additional_charges',
            'splitinfo': 'splitInfo',
            'split_info': 'splitInfo',
            'splitInfo': 'splitInfo'
        };
        
        function parseAndFillForm() {
            const callbackData = document.getElementById('callbackData').value.trim();
            const resultDiv = document.getElementById('parseResult');
            
            if (!callbackData) {
                showParseResult('<i class="fas fa-exclamation-triangle"></i> Please paste callback data first.', false);
                return;
            }
            
            const currentHashType = document.getElementById('hashType').value;
            
            const allFormFields = [
                'status', 'firstname', 'email', 'productinfo', 'amount', 'txnid', 'key', 'responseHash',
                'udf1', 'udf2', 'udf3', 'udf4', 'udf5', 'additional_charges', 'splitInfo'
            ];
            allFormFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = '';
                }
            });
            
            try {
                let parsedData = {};
                let parseMethod = '';
                
                if (callbackData.startsWith('{') || callbackData.startsWith('[')) {
                    try {
                        parsedData = JSON.parse(callbackData);
                        parseMethod = 'JSON';
                    } catch (e) {
                        throw new Error('Invalid JSON format');
                    }
                } else if (callbackData.includes('] =>')) {
                    parseMethod = 'PHP Array (print_r style)';
                    const lines = callbackData.split('\n').filter(line => line.trim());
                    
                    lines.forEach(line => {
                        const trimmedLine = line.trim();
                        const match = trimmedLine.match(/^\s*\[([^\]]+)\]\s*=>\s*(.*)$/);
                        if (match) {
                            const key = match[1].trim();
                            let value = match[2].trim();
                            
                            if (value === '' || value === 'Array') {
                                value = '';
                            } else if (value.startsWith('(') && !value.startsWith('(')) {
                                value = '';
                            }
                            
                            parsedData[key] = value;
                        }
                    });
                } else if (callbackData.includes('=') && (callbackData.includes('&') || callbackData.includes('\n') || !callbackData.includes(' '))) {
                    const isUrlEncoded = callbackData.includes('%') || callbackData.includes('+');
                    parseMethod = isUrlEncoded ? 'URL-Encoded Parameters' : 'URL Parameters';
                    
                    const params = callbackData.split(/[&\n]/).filter(param => param.trim());
                    
                    params.forEach(param => {
                        const [key, ...valueParts] = param.split('=');
                        if (key && valueParts.length > 0) {
                            let value = valueParts.join('=');
                            
                            try {
                                value = value.replace(/\+/g, ' ');
                                value = decodeURIComponent(value.trim());
                            } catch (e) {
                                console.warn('URL decode failed for:', value, e);
                                value = value.trim();
                            }
                            
                            parsedData[key.trim()] = value;
                        }
                    });
                } else {
                    parseMethod = 'Key-Value Pairs';
                    const lines = callbackData.split(/[\n,;]/).filter(line => line.trim());
                    
                    let currentKey = null;
                    let currentValue = '';
                    let inJsonObject = false;
                    let bracketDepth = 0;
                    
                    lines.forEach(line => {
                        const trimmedLine = line.trim();
                        if (!trimmedLine) return;
                        
                        if (inJsonObject) {
                            currentValue += ' ' + trimmedLine;
                            
                            for (let i = 0; i < trimmedLine.length; i++) {
                                if (trimmedLine[i] === '{' || trimmedLine[i] === '[') {
                                    bracketDepth++;
                                } else if (trimmedLine[i] === '}' || trimmedLine[i] === ']') {
                                    bracketDepth--;
                                }
                            }
                            
                            if (bracketDepth <= 0) {
                                inJsonObject = false;
                                if (currentKey) {
                                    parsedData[currentKey] = currentValue.trim();
                                    currentKey = null;
                                    currentValue = '';
                                }
                            }
                            return;
                        }
                        
                        const colonIndex = trimmedLine.indexOf(':');
                        const equalIndex = trimmedLine.indexOf('=');
                        
                        let separator = -1;
                        if (colonIndex !== -1 && (equalIndex === -1 || colonIndex < equalIndex)) {
                            separator = colonIndex;
                        } else if (equalIndex !== -1) {
                            separator = equalIndex;
                        }
                        
                        if (separator !== -1) {
                            const key = trimmedLine.substring(0, separator).trim();
                            const value = trimmedLine.substring(separator + 1).trim();
                            
                            if (key && value) {
                                if ((value.startsWith('{') && !value.endsWith('}')) || 
                                    (value.startsWith('[') && !value.endsWith(']')) ||
                                    (value.includes('{') && !value.includes('}'))) {
                                    currentKey = key;
                                    currentValue = value;
                                    inJsonObject = true;
                                    bracketDepth = 0;
                                    
                                    for (let i = 0; i < value.length; i++) {
                                        if (value[i] === '{' || value[i] === '[') {
                                            bracketDepth++;
                                        } else if (value[i] === '}' || value[i] === ']') {
                                            bracketDepth--;
                                        }
                                    }
                                    
                                    if (bracketDepth <= 0) {
                                        inJsonObject = false;
                                        parsedData[key] = value;
                                        currentKey = null;
                                        currentValue = '';
                                    }
                                } else {
                                    parsedData[key] = value;
                                }
                            }
                        }
                    });
                    
                    if (inJsonObject && currentKey && currentValue) {
                        parsedData[currentKey] = currentValue.trim();
                    }
                }
                
                let filledFields = [];
                let skippedFields = [];
                let formulaSpecificFields = [];
                
                const hasAdditionalCharges = parsedData.hasOwnProperty('additionalcharges') || 
                                            parsedData.hasOwnProperty('additional_charges') || 
                                            parsedData.hasOwnProperty('additionalCharges');
                const hasSplitInfo = parsedData.hasOwnProperty('splitinfo') || 
                                   parsedData.hasOwnProperty('split_info') || 
                                   parsedData.hasOwnProperty('splitInfo');
                
                const hashTypeSelect = document.getElementById('hashType');
                let detectedHashType = currentHashType;
                
                if (hasAdditionalCharges && hasSplitInfo) {
                    detectedHashType = 'combined';
                } else if (hasAdditionalCharges) {
                    detectedHashType = 'additional_charges';
                } else if (hasSplitInfo) {
                    detectedHashType = 'split';
                } else {
                    detectedHashType = 'normal';
                }
                
                hashTypeSelect.value = detectedHashType;
                
                const relevantFields = {
                    'normal': ['status', 'firstname', 'email', 'productinfo', 'amount', 'txnid', 'key', 'hash', 'udf1', 'udf2', 'udf3', 'udf4', 'udf5'],
                    'additional_charges': ['status', 'firstname', 'email', 'productinfo', 'amount', 'txnid', 'key', 'hash', 'udf1', 'udf2', 'udf3', 'udf4', 'udf5', 'additionalcharges', 'additional_charges'],
                    'split': ['status', 'firstname', 'email', 'productinfo', 'amount', 'txnid', 'key', 'hash', 'udf1', 'udf2', 'udf3', 'udf4', 'udf5', 'splitinfo', 'split_info'],
                    'combined': ['status', 'firstname', 'email', 'productinfo', 'amount', 'txnid', 'key', 'hash', 'udf1', 'udf2', 'udf3', 'udf4', 'udf5', 'additionalcharges', 'additional_charges', 'splitinfo', 'split_info']
                };
                
                Object.keys(parsedData).forEach(key => {
                    const keyLower = key.toLowerCase();
                    const fieldId = fieldMapping[keyLower];
                    if (fieldId && fieldId !== 'salt') {
                        const isRelevantField = relevantFields[detectedHashType].includes(keyLower);
                        
                        if (isRelevantField) {
                            const element = document.getElementById(fieldId);
                            if (element) {
                                element.value = parsedData[key];
                                filledFields.push(key);
                                
                                if (keyLower === 'additionalcharges' || keyLower === 'additional_charges' || keyLower === 'splitinfo' || keyLower === 'split_info') {
                                    formulaSpecificFields.push(key);
                                }
                                
                                element.dispatchEvent(new Event('change'));
                            }
                        } else {
                            skippedFields.push(key + ' (not relevant for ' + detectedHashType + ')');
                        }
                    } else if (keyLower !== 'salt') {
                        skippedFields.push(key + ' (unmapped field)');
                    }
                });
                
                let hashTypeSwitched = false;
                
                if (detectedHashType !== currentHashType) {
                    updateHashLogic();
                }
                
                const formulaNames = {
                    'normal': 'Normal Reverse Hash Verification',
                    'additional_charges': 'Additional Charges Reverse Hash Verification',
                    'split': 'Split Reverse Hash Verification',
                    'combined': 'Combined Split & Additional Charges Reverse Hash Verification'
                };
                const currentFormulaName = formulaNames[detectedHashType] || detectedHashType;
                
                const additionalChargesValue = (document.getElementById('additional_charges').value || '').trim();
                const splitInfoValue = (document.getElementById('splitInfo').value || '').trim();
                
                let message = '<i class="fas fa-check-circle"></i> <strong>Successfully parsed ' + parseMethod + ' format!</strong><br><br>';
                
                message += '<strong><i class="fas fa-cogs"></i> Current Formula:</strong> <span class="status-indicator status-success">' + currentFormulaName + '</span><br><br>';
                
                message += '<strong><i class="fas fa-exclamation-triangle"></i> Remember:</strong> Please manually enter your SALT value before verification.<br>';
                
                if (additionalChargesValue && additionalChargesValue.length > 0) {
                    message += '<br><strong><i class="fas fa-dollar-sign"></i> Additional Charges Found:</strong> <code style="background: rgba(16, 185, 129, 0.2); padding: 4px 8px; border-radius: 4px;">' + additionalChargesValue + '</code><br>';
                }
                
                if (splitInfoValue && splitInfoValue.length > 0) {
                    var displaySplitInfo = splitInfoValue.length > 80 ? splitInfoValue.substring(0, 80) + '...' : splitInfoValue;
                    message += '<br><strong><i class="fas fa-code-branch"></i> Split Info Found:</strong> <code style="background: rgba(16, 185, 129, 0.2); padding: 4px 8px; border-radius: 4px;">' + displaySplitInfo + '</code><br>';
                }
                
                if (filledFields.length > 0) {
                    message += '<br><strong><i class="fas fa-check-double"></i> Filled ' + filledFields.length + ' fields:</strong> ' + filledFields.slice(0, 10).join(', ');
                    if (filledFields.length > 10) {
                        message += ' and ' + (filledFields.length - 10) + ' more...';
                    }
                    message += '<br>';
                }
                
                if (parseMethod === 'URL-Encoded Parameters') {
                    message += '<br><strong><i class="fas fa-unlock"></i> URL Decoding Applied:</strong> Automatically decoded URL-encoded values (+ â†’ space, %40 â†’ @, %3A â†’ :, etc.)<br>';
                }
                
                if (detectedHashType !== currentHashType) {
                    message += '<br><strong><i class="fas fa-sync-alt"></i> Auto-detected Formula:</strong> Automatically switched to <span class="status-indicator status-success">' + currentFormulaName + '</span> based on found fields<br>';
                }
                
                showParseResult(message, true);
                
                document.getElementById('hashVerificationForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
            } catch (error) {
                showParseResult(`<i class="fas fa-times-circle"></i> Failed to parse callback data: ${error.message}<br><br>Please check the format and try again.`, false);
            }
        }
        
        function showParseResult(message, isSuccess) {
            const resultDiv = document.getElementById('parseResult');
            resultDiv.className = isSuccess ? 'parse-result parse-success' : 'parse-result parse-error';
            resultDiv.innerHTML = message;
            resultDiv.style.display = 'block';
        }
        
        function clearAllFields() {
            document.getElementById('callbackData').value = '';
            
            const formFields = [
                'status', 'firstname', 'email', 'productinfo', 'amount', 'txnid', 'key', 'responseHash',
                'udf1', 'udf2', 'udf3', 'udf4', 'udf5', 'additional_charges', 'splitInfo'
            ];
            
            if (confirm('Clear all fields? (Salt will be preserved)')) {
                formFields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) {
                        element.value = '';
                    }
                });
                
                document.getElementById('hashType').value = 'normal';
                updateHashLogic();
                
                document.getElementById('parseResult').style.display = 'none';
                document.getElementById('verificationResult').style.display = 'none';
                
                showParseResult('<i class="fas fa-check-circle"></i> All fields cleared successfully!', true);
            }
        }
        
        function updateHashLogic() {
            var hashType = document.getElementById('hashType').value;
            var hashLogicCode = document.getElementById('hashLogicCode');
            var additionalChargesField = document.getElementById('additionalChargesField');
            var splitInfoField = document.getElementById('splitInfoField');
            
            additionalChargesField.classList.remove('active');
            splitInfoField.classList.remove('active');
            
            switch(hashType) {
                case 'normal':
                    hashLogicCode.textContent = 'sha512(SALT|status||||||udf5|udf4|udf3|udf2|udf1|email|firstname|productinfo|amount|txnid|key)';
                    break;
                case 'additional_charges':
                    additionalChargesField.classList.add('active');
                    hashLogicCode.textContent = 'sha512(additional_charges|SALT|status||||||udf5|udf4|udf3|udf2|udf1|email|firstname|productinfo|amount|txnid|key)';
                    break;
                case 'split':
                    splitInfoField.classList.add('active');
                    hashLogicCode.textContent = 'sha512(SALT|status|splitInfo||||||udf5|udf4|udf3|udf2|udf1|email|firstname|productinfo|amount|txnid|key)';
                    break;
                case 'combined':
                    additionalChargesField.classList.add('active');
                    splitInfoField.classList.add('active');
                    hashLogicCode.textContent = 'sha512(additional_charges|SALT|status|splitInfo||||||udf5|udf4|udf3|udf2|udf1|email|firstname|productinfo|amount|txnid|key)';
                    break;
            }
        }
        
        function verifyHash() {
            var hashType = document.getElementById('hashType').value;
            var additional_charges = document.getElementById('additional_charges').value.trim() || "";
            var splitInfo = document.getElementById('splitInfo').value.trim() || "";
            var salt = document.getElementById('salt').value.trim();
            var status = document.getElementById('status').value.trim();
            var udf5 = document.getElementById('udf5').value.trim() || "";
            var udf4 = document.getElementById('udf4').value.trim() || "";
            var udf3 = document.getElementById('udf3').value.trim() || "";
            var udf2 = document.getElementById('udf2').value.trim() || "";
            var udf1 = document.getElementById('udf1').value.trim() || "";
            var email = document.getElementById('email').value.trim();
            var firstname = document.getElementById('firstname').value.trim();
            var productinfo = document.getElementById('productinfo').value.trim();
            var amount = document.getElementById('amount').value.trim();
            var txnid = document.getElementById('txnid').value.trim();
            var key = document.getElementById('key').value.trim();
            var responseHash = document.getElementById('responseHash').value.trim();
            
            if (!salt || !key || !responseHash || !status || !txnid || !amount || !productinfo || !firstname || !email) {
                alert('Please fill in all required fields.');
                return;
            }
            
            if (hashType === 'additional_charges' && !additional_charges) {
                alert('Additional charges field is required for this hash type.');
                return;
            }
            
            if (hashType === 'split' && !splitInfo) {
                alert('Split info field is required for this hash type.');
                return;
            }
            
            if (hashType === 'combined' && (!additional_charges || !splitInfo)) {
                alert('Both Additional charges and Split info fields are required for the Combined formula.');
                return;
            }
            
            var hashVariations = [];
            var baseString = "";
            
            switch(hashType) {
                case 'normal':
                    baseString = salt + "|" + status + "||||||" + udf5 + "|" + udf4 + "|" + udf3 + "|" + udf2 + "|" + udf1 + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
                case 'additional_charges':
                    baseString = additional_charges + "|" + salt + "|" + status + "||||||" + udf5 + "|" + udf4 + "|" + udf3 + "|" + udf2 + "|" + udf1 + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
                case 'split':
                    baseString = salt + "|" + status + "|" + splitInfo + "||||||" + udf5 + "|" + udf4 + "|" + udf3 + "|" + udf2 + "|" + udf1 + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
                case 'combined':
                    baseString = additional_charges + "|" + salt + "|" + status + "|" + splitInfo + "||||||" + udf5 + "|" + udf4 + "|" + udf3 + "|" + udf2 + "|" + udf1 + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
            }
            
            hashVariations.push(baseString);
            
            if (hashType === 'normal') {
                var hashString2 = salt + "|" + status + "||||||||||||" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                hashVariations.push(hashString2);
            } else if (hashType === 'additional_charges') {
                var hashString2 = additional_charges + "|" + salt + "|" + status + "||||||||||||" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                hashVariations.push(hashString2);
            } else if (hashType === 'split') {
                var hashString2 = salt + "|" + status + "|" + splitInfo + "||||||||||||" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                hashVariations.push(hashString2);
            } else if (hashType === 'combined') {
                var hashString2 = additional_charges + "|" + salt + "|" + status + "|" + splitInfo + "||||||||||||" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                hashVariations.push(hashString2);
            }
            
            function emptyToString(val) {
                return (val === undefined || val === null || val === "") ? "" : val;
            }
            
            var hashString3;
            switch(hashType) {
                case 'normal':
                    hashString3 = salt + "|" + status + "||||||" + emptyToString(udf5) + "|" + emptyToString(udf4) + "|" + emptyToString(udf3) + "|" + emptyToString(udf2) + "|" + emptyToString(udf1) + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
                case 'additional_charges':
                    hashString3 = additional_charges + "|" + salt + "|" + status + "||||||" + emptyToString(udf5) + "|" + emptyToString(udf4) + "|" + emptyToString(udf3) + "|" + emptyToString(udf2) + "|" + emptyToString(udf1) + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
                case 'split':
                    hashString3 = salt + "|" + status + "|" + splitInfo + "||||||" + emptyToString(udf5) + "|" + emptyToString(udf4) + "|" + emptyToString(udf3) + "|" + emptyToString(udf2) + "|" + emptyToString(udf1) + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
                case 'combined':
                    hashString3 = additional_charges + "|" + salt + "|" + status + "|" + splitInfo + "||||||" + emptyToString(udf5) + "|" + emptyToString(udf4) + "|" + emptyToString(udf3) + "|" + emptyToString(udf2) + "|" + emptyToString(udf1) + "|" + email + "|" + firstname + "|" + productinfo + "|" + amount + "|" + txnid + "|" + key;
                    break;
            }
            hashVariations.push(hashString3);
            
            hashVariations.push(baseString);
            
            var results = [];
            var isValidAny = false;
            var matchedVariation = null;
            var matchedHash = null;
            
            for (var i = 0; i < hashVariations.length; i++) {
                var currentString = hashVariations[i];
                var calculatedHash;
                
                if (i === 3) {
                    calculatedHash = CryptoJS.SHA512(currentString).toString();
                } else {
                    calculatedHash = CryptoJS.SHA512(currentString).toString().toLowerCase();
                }
                
                var comparisonHash;
                if (i === 3) {
                    comparisonHash = responseHash;
                } else {
                    comparisonHash = responseHash.toLowerCase();
                }
                
                var isValid = calculatedHash === comparisonHash;
                
                results.push({
                    string: currentString,
                    hash: calculatedHash,
                    isValid: isValid
                });
                
                if (isValid) {
                    isValidAny = true;
                    matchedVariation = i + 1;
                    matchedHash = calculatedHash;
                }
            }
            
            var resultDiv = document.getElementById('verificationResult');
            resultDiv.style.display = 'block';
            resultDiv.className = isValidAny ? 'verification-result verification-success' : 'verification-result verification-error';
            
            var hashTypeDisplayName = hashType === 'normal' ? 'Normal Hash' : 
                                     hashType === 'additional_charges' ? 'Additional Charges Reverse Hash' : 
                                     hashType === 'split' ? 'Split Reverse Hash' :
                                     'Combined Split & Additional Charges Hash';
            
            var resultHtml = isValidAny ? 
                '<div><i class="fas fa-check-circle"></i> <strong>' + hashTypeDisplayName + ' Verification SUCCESSFUL!</strong> <span class="status-indicator status-success">Matched variation ' + matchedVariation + '</span></div>' : 
                '<div><i class="fas fa-times-circle"></i> <strong>' + hashTypeDisplayName + ' Verification FAILED!</strong></div>';
            
            if (isValidAny) {
                resultHtml += '<div class="verification-details">' +
                    '<strong>Hash Type:</strong> ' + hashTypeDisplayName + '<br><br>' +
                    '<strong>String for Hashing (that worked):</strong><br>' + results[matchedVariation-1].string + '<br><br>' +
                    '<strong>Calculated Hash:</strong><br>' + matchedHash + '<br><br>' +
                    '<strong>Response Hash:</strong><br>' + responseHash +
                    '</div>';
                
                if (matchedVariation === 1) {
                    resultHtml += '<div class="debug-info"><i class="fas fa-info-circle"></i> <strong>Success Details:</strong> Standard hash format verification successful for ' + hashTypeDisplayName + '.</div>';
                } else if (matchedVariation === 2) {
                    resultHtml += '<div class="debug-info"><i class="fas fa-info-circle"></i> <strong>Success Details:</strong> Verification successful with all UDFs treated as empty for ' + hashTypeDisplayName + '.</div>';
                } else if (matchedVariation === 3) {
                    resultHtml += '<div class="debug-info"><i class="fas fa-info-circle"></i> <strong>Success Details:</strong> Verification successful with strict null handling for ' + hashTypeDisplayName + '.</div>';
                } else if (matchedVariation === 4) {
                    resultHtml += '<div class="debug-info"><i class="fas fa-info-circle"></i> <strong>Success Details:</strong> Verification successful with case-sensitive comparison for ' + hashTypeDisplayName + '.</div>';
                }
            } else {
                resultHtml += '<div class="verification-details">' +
                    '<strong>Hash Type:</strong> ' + hashTypeDisplayName + '<br><br>' +
                    '<strong>Response Hash:</strong><br>' + responseHash + '<br><br>' +
                    '<strong>Attempted Variations:</strong><br>';
                    
                for (var j = 0; j < results.length; j++) {
                    var result = results[j];
                    resultHtml += '<hr><strong>Variation ' + (j + 1) + ':</strong><br>' +
                    'String: ' + result.string + '<br>' +
                    'Hash: ' + result.hash + '<br>' +
                    'Result: ' + (result.isValid ? "âœ… Matched" : "âŒ Not Matched") + '<br>';
                }
                
                resultHtml += '</div>' +
                '<div class="debug-info">' +
                    '<strong><i class="fas fa-tools"></i> Debugging Tips:</strong><br>' +
                    'â€¢ Double-check your SALT value<br>' +
                    'â€¢ Verify all values match exactly what PayU sent (including case)<br>' +
                    'â€¢ Check for any special characters or encoding issues<br>' +
                    'â€¢ Amount format might need specific decimal places (e.g. "10.00" vs "10")<br>' +
                    'â€¢ For ' + hashTypeDisplayName + ', ensure all required fields are properly filled' +
                '</div>';
            }
            
            resultDiv.innerHTML = resultHtml;
            
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        window.onload = function() {
            updateHashLogic();
        };
    </script>
</body>
</html>
